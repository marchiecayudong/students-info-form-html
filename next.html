<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Manage Students</title>
<style>
  :root{--green:#1b7a3f;--bg:#f6fff6;--card:#fff;--muted:#3d6b53}
  *{box-sizing:border-box;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#eefbf0);color:var(--muted);padding:20px;min-height:100vh}
  .wrap{width:100%;max-width:980px;margin:0 auto;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(20,60,30,0.06)}
  header{display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;color:var(--green);font-size:1.05rem}
  .controls{display:flex;gap:8px}
  .btn{background:var(--green);color:white;padding:9px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
  .btn.ghost{background:transparent;color:var(--green);border:1px solid rgba(27,120,63,0.12)}
  .list{margin-top:14px;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px}
  .cardItem{background:linear-gradient(180deg,#fff,#fbfff9);border-radius:10px;padding:12px;border:1px solid rgba(27,120,63,0.06);cursor:pointer}
  .cardItem h3{margin:0;color:#2f6b4f}
  .meta{font-size:.86rem;color:#7a8f7a;margin-top:6px}
  .empty{padding:18px;border-radius:10px;background:#fbfff9;border:1px dashed #d7efdb;color:#7f9c86}
  /* modal */
  .overlay{position:fixed;inset:0;background:rgba(10,30,14,0.35);display:flex;align-items:center;justify-content:center;z-index:60}
  .modal{width:100%;max-width:700px;background:white;border-radius:12px;padding:16px;box-shadow:0 30px 50px rgba(10,40,20,0.3)}
  .modal header{display:flex;justify-content:space-between;align-items:center}
  .modal dl{display:grid;grid-template-columns:140px 1fr;gap:8px 12px;margin-top:12px}
  .modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  .danger{background:#d9534f;color:white}
  @media(max-width:520px){.modal dl{grid-template-columns:110px 1fr}}
</style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <h1>Filled Students</h1>
      <div class="controls">
        <a href="index.html" class="btn" style="text-decoration:none">➕ Add New</a>
        <button id="clearAll" class="btn ghost">Clear All</button>
      </div>
    </header>

    <section id="listArea">
      <!-- list generated by JS -->
    </section>
  </div>

<script>
  // storage helpers
  function loadStudents(){
    try {
      const raw = localStorage.getItem('students') || '[]';
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) return [];
      // keep only valid objects with name
      return arr.filter(s => s && (s.firstName || s.lastName));
    } catch(e){ return []; }
  }
  function saveStudents(arr){ localStorage.setItem('students', JSON.stringify(arr || [])); }

  const listArea = document.getElementById('listArea');

  function renderList(){
    const students = loadStudents();
    if (students.length === 0) {
      listArea.innerHTML = '<div class="empty" style="margin-top:14px">No saved student entries yet. Add one using "Add New".</div>';
      return;
    }
    const grid = document.createElement('div');
    grid.className = 'list';
    students.forEach((s, idx) => {
      const b = document.createElement('button');
      b.type='button';
      b.className='cardItem';
      b.setAttribute('data-idx', idx);
      b.innerHTML = `<h3>${s.firstName || ''} ${s.lastName || ''}</h3>
                     <div class="meta">${s.course || '—'} • ${s.yearLevel || '—'}</div>
                     <div style="margin-top:8px;font-size:.82rem;color:#9aa99a">Click to view details</div>`;
      b.addEventListener('click', ()=> openModal(idx));
      grid.appendChild(b);
    });
    listArea.innerHTML = '';
    listArea.appendChild(grid);
  }

  // modal logic
  let currentIndex = null;
  function openModal(index){
    const students = loadStudents();
    if (!students[index]) return;
    currentIndex = index;
    const s = students[index];

    const overlay = document.createElement('div');
    overlay.className = 'overlay';
    overlay.id = 'overlay';

    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
      <header>
        <div>
          <strong style="color:var(--green);font-size:1.05rem">${(s.firstName||'') + ' ' + (s.lastName||'')}</strong>
          <div style="color:#7a8f7a">${s.course || '-'} • ${s.yearLevel || '-'}</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prevBtn" class="btn ghost" style="padding:8px 10px">◀ Prev</button>
          <button id="nextBtn" class="btn ghost" style="padding:8px 10px">Next ▶</button>
          <button id="closeBtn" class="btn" style="padding:8px 10px">Close</button>
        </div>
      </header>
      <dl>
        <dt>Student No.</dt><dd>${s.studentNo || '-'}</dd>
        <dt>Age</dt><dd>${s.age || '-'}</dd>
        <dt>Email</dt><dd>${s.email || '-'}</dd>
        <dt>Phone</dt><dd>${s.phone || '-'}</dd>
        <dt>Address</dt><dd>${s.address || '-'}</dd>
        <dt>Gender</dt><dd>${s.gender || '-'}</dd>
        <dt>Created</dt><dd>${new Date(s.createdAt).toLocaleString()}</dd>
      </dl>
      <div class="actions" style="display:flex;justify-content:flex-end;margin-top:12px">
        <button id="deleteBtn" class="danger btn">Delete</button>
      </div>
    `;
    overlay.appendChild(modal);
    document.body.appendChild(overlay);

    // handlers
    document.getElementById('closeBtn').addEventListener('click', closeModal);
    document.getElementById('prevBtn').addEventListener('click', ()=> navigate(-1));
    document.getElementById('nextBtn').addEventListener('click', ()=> navigate(1));
    document.getElementById('deleteBtn').addEventListener('click', () => {
      if (!confirm('Delete this student? This cannot be undone.')) return;
      const arr = loadStudents();
      arr.splice(currentIndex, 1);
      saveStudents(arr);
      closeModal();
      renderList();
    });

    overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });
  }

  function closeModal(){ const ov = document.getElementById('overlay'); if (ov) ov.remove(); currentIndex = null; }

  function navigate(dir){
    const arr = loadStudents();
    if (!Array.isArray(arr) || arr.length === 0 || currentIndex === null) return;
    const next = (currentIndex + dir + arr.length) % arr.length;
    closeModal();
    // small timeout for DOM cleanup
    setTimeout(()=> openModal(next), 50);
  }

  // clear all
  document.getElementById('clearAll').addEventListener('click', ()=> {
    if (!confirm('Remove all saved students from local storage?')) return;
    localStorage.removeItem('students');
    renderList();
  });

  // initial render
  renderList();

  // react to storage changes (other tabs)
  window.addEventListener('storage', (e)=> { if (e.key === 'students') renderList(); });
</script>
</body>
</html>
